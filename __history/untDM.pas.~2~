unit untDM;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ComCtrls, Menus,  ImgList, ExtCtrls, jpeg, StdCtrls,
  Buttons,inifiles, DB, ibx.IBCustomDataSet, ibx.IbQuery, ToolWin,
  IBDatabase;

type
  TDM = class(TDataModule)
    BANCO: TIBDatabase;
    TRANSACAO: TIBTransaction;
    TOTAL: TIBDatabase;
    TRANSATOTAL: TIBTransaction;
    VISITAS: TIBDatabase;
    TRANSAVISITAS: TIBTransaction;
    procedure DataModuleCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  DM: TDM;

implementation

{$R *.dfm}

procedure TDM.DataModuleCreate(Sender: TObject);
var
 arqini:tinifile;
begin
try
 ArqIni             := tIniFile.Create(extractfilepath(application.exename) +'\config');
 BANCO.Connected    := false;
 TOTAL.Connected    := FALSE;

 banco.DatabaseName := ArqIni.Readstring('VENDAS', 'CAMINHO','');
 total.DatabaseName := ArqIni.Readstring('RELATORIO', 'CAMINHO','');
 VISITAS.DatabaseName := ArqIni.Readstring('VISITAS', 'CAMINHO','');

 BANCO.Connected    := TRUE;
 TOTAL.Connected    := TRUE;
 VISITAS.Connected    := TRUE;

 ArqIni.Free;
except
  banco.Connected   := false;
  messagedlg('Não foi possível conectar-se ao BANCO DE DADOS! O servidor deve estar desligado ou não entraram no sistema da máquina do SERVIDOR. Entre em contato com a pessoa responsável pelo servidor e REINICIE sua máquina! Persistindo contacte o ADMINISTRADOR.',mterror,[mbok],0);
end;

end;

end.
